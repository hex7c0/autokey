"use strict";function body(a,b){for(var c=a,d=[],e=b,f=e.length,g=f,h=0,i=c.length;i>h;h++)g>0?(d[h]=(c[h]+e.shift())%256,g--):d[h]=(c[h]+c[h-f])%256;return new Buffer(d)}function _body(a,b){for(var c=a,d=[],e=b,f=e.length,g=f,h=0,i=c.length;i>h;h++)g>0?(d[h]=(c[h]-e.shift())%256,g--):d[h]=(c[h]-d[h-f])%256;return new Buffer(d)}function AUTOKEY(a){this.key=null,this.change(a)}module.exports=function(a){return new AUTOKEY(a)},AUTOKEY.prototype.change=function(a){if(Array.isArray(a))this.key=a;else{if("string"!=typeof a&&!Buffer.isBuffer(a))throw new Error("Invalid data");this.key=new Array(a.legth);for(var b=new Buffer(a),c=0,d=b.length;d>c;c++)this.key[c]=b[c]}},AUTOKEY.prototype.encodeString=function(a,b,c){var d=new Buffer(a,b||"utf8");return body(d,this.key.slice()).toString(c||"hex")},AUTOKEY.prototype.encodeArray=function(a){for(var b=body(new Buffer(a),this.key.slice()),c=new Array(b.length),d=0,e=b.length;e>d;d++)c[d]=b[d];return c},AUTOKEY.prototype.encodeBuffer=function(a){return body(a,this.key.slice())},AUTOKEY.prototype.encode=function(a,b,c){if("string"==typeof a)return this.encodeString(a,b,c);if(Array.isArray(a))return this.encodeArray(a);if(Buffer.isBuffer(a))return this.encodeBuffer(a);throw new Error("Invalid data")},AUTOKEY.prototype.decodeString=function(a,b,c){var d=new Buffer(a,b||"hex");return _body(d,this.key.slice()).toString(c||"utf8")},AUTOKEY.prototype.decodeArray=function(a){for(var b=_body(new Buffer(a),this.key.slice()),c=new Array(b.length),d=0,e=b.length;e>d;d++)c[d]=b[d];return c},AUTOKEY.prototype.decodeBuffer=function(a){return _body(a,this.key.slice())},AUTOKEY.prototype.decode=function(a,b,c){if("string"==typeof a)return this.decodeString(a,b,c);if(Array.isArray(a))return this.decodeArray(a);if(Buffer.isBuffer(a))return this.decodeBuffer(a);throw new Error("Invalid data")};
